# Ego微商小程序实战

## 设计篇 [03-微信小程序第三天笔记.pdf](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day03\01-课堂资料\03-微信小程序第三天笔记.pdf) 

### 测试计划

 [Ego微商小程序测试计划V1.0.2.doc](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day02\01-课堂资料\Ego微商小程序测试计划V1.0.2.doc) 

### 设计思路

 [设计思路.xmind](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day03\01-课堂资料\设计思路.xmind) 

参考需求说明设计测试点[Ego微商小程序需求说明V1.0.doc](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\项目资料\01-文档资料\Ego微商小程序需求说明V1.0.doc) 

### 主页功能测试

 [主页功能测试点.xmind](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day03\01-课堂资料\主页功能测试点.xmind) 

测试用例：

 [Ego微商小程序手工测试用例.xlsx](..\测试文档\Ego微商小程序手工测试用例.xlsx) 

### 非功能性测试

 [非功能测试点.xmind](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day03\01-课堂资料\非功能测试点.xmind) 

测试用例参考

 [Ego微商小程序手工测试用例（参考）.xlsx](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day03\01-课堂资料\Ego微商小程序手工测试用例（参考）.xlsx) 

## 执行篇

### 测试执行跟踪

 [06-Ego微商项目讲义V1.1（水印）.pdf](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\微信小程序讲义V5.0版本\06-Ego微商项目讲义V1.1（水印）.pdf) 

### 测试报告总结

 [06-Ego微商项目讲义V1.1（水印）.pdf](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\微信小程序讲义V5.0版本\06-Ego微商项目讲义V1.1（水印）.pdf) 

 [Ego微商小程序项目测试报告V1.0 .doc](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day03\01-课堂资料\Ego微商小程序项目测试报告V1.0 .doc) 

### 接口测试

 [07-Ego微商项目讲义V1.1（水印）.pdf](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\微信小程序讲义V5.0版本\07-Ego微商项目讲义V1.1（水印）.pdf) 

 [04-微信小程序第四天笔记.pdf](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day04\01-课堂资料\04-微信小程序第四天笔记.pdf) 

 [Ego项目第四天.xmind](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day04\01-课堂资料\Ego项目第四天.xmind) 

 [Ego微商小程序-API文档-w.pdf](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\项目资料\01-文档资料\Ego微商小程序-API文档-w.pdf) 

 [Ego微商小程序接口测试用例.xlsx](..\软件测试\测试资料【密码是：666java.com】\测试资料\06第六阶段-Ego微商小程序项目实战\06第六阶段-Ego微商小程序项目实战\wx-day04\01-课堂资料\Ego微商小程序接口测试用例.xlsx) 

#### 接口实现(Postman)

![image-20240320190736967](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240320190736967.png)

##### 创建测试用例集

![image-20240320201001804](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240320201001804.png)

##### 模块创建

![image-20240321111248648](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321111248648.png)

默认从上往下顺序执行，顺序调换可能报错

##### 首页

###### 获取轮播图

![image-20240321111412301](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321111412301.png)



创建请求

![image-20240321111540269](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321111540269.png)



发送请求，获取响应

![image-20240321112036910](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321112036910.png)



响应断言

断言响应状态码

断言响应数据

![image-20240321113251182](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321113251182.png)



测试优化，添加环境变量

![image-20240321120525069](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321120525069.png)

newman生成测试报告用**Initial value** 的值



引用

![image-20240321120653490](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321120653490.png)



断言参数化

![image-20240321121032576](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321121032576.png)

###### 获取专题栏

响应体格式为列表

![image-20240321152135034](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321152135034.png)

对列表进行断言

第一种方式

![image-20240321152252455](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321152252455.png)

第二种方式

![image-20240321152708670](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321152708670.png)



设置环境变量，考虑可变情况

![image-20240321153830344](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321153830344.png)

###### 获取最新商品

###### ![image-20240321154700093](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321154700093.png)

##### 商品

###### 获取商品分类

![image-20240321163504749](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321163504749.png)

###### 获取商品分类下的商品

![image-20240321163607728](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321163607728.png)

###### 获取商品信息

![image-20240321164907075](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321164907075.png)

##### 用户权限

###### 获取token指令

![image-20240321195838437](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321195838437.png)



![image-20240321195809335](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321195809335.png)

设置断言

![image-20240321195931964](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321195931964.png)

###### 获取的token保存到环境变量

![image-20240321201644633](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321201644633.png)

###### 验证token接口

![image-20240321202252546](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321202252546.png)

![image-20240321202321529](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321202321529.png)

###### 获取地址信息接口

![image-20240321202704385](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321202704385.png)

断言

![image-20240321203123406](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321203123406.png)

###### 用例批量执行（多接口）

![image-20240321204835915](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321204835915.png)

全部测试通过

![image-20240321204856936](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321204856936.png)

##### 生成测试报告

###### 导出测试用例集

![image-20240321210040765](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321210040765.png)

###### 导出环境文件

重新编译，更新code值，导出

![image-20240321210407577](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240321210407577.png)

命令行使用newman命令生成测试报告

![image-20240322090755839](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322090755839.png)

查看生成的测试报告

![image-20240322090843036](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322090843036.png)

#### 代码实现接口测试（Python+Requests+Unittest）

![image-20240322091953602](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322091953602.png)

##### 项目搭建

![image-20240322092251798](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322092251798.png)

![image-20240322093502905](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322093502905.png)

##### 初始化日志函数

通过控制台显示日志信息（按照指定格式显示）
在测试过程中能够动态的生成日志文件，方便后续排查问题

![image-20240322094131946](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322094131946.png)

![image-20240322094210192](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322094210192.png)

```python
# 1.导包
import logging
import app
from logging import handlers


# 2.定义初始化日志函数
def init_log():
    # 定义日志器
    logger = logging.getLogger()  # 初始化日志器对象
    logger.setLevel(logging.INFO)  # 设置日志器对应的日志格式，对应级别
    # 定义处理器
    sh = logging.StreamHandler()  # 控制台处理器
    log_file = app.BASE_DIR + "/log/Ego.log"

    # 文件处理器
    fh = logging.handlers.TimedRotatingFileHandler(log_file,  # 定义日志文件
                                                   when="D",  # 记录日志时间：每天
                                                   interval=1,  # 记录日志的频率
                                                   backupCount=7,  # 保存日志的时间
                                                   encoding="UTF-8",  # 记录日志的编码方式
                                                   )  # 文件处理器
    # 定义格式化器
    fmt = "%(asctime)s %(levelname)s [%(name)s] [%(filename)s(%(funcName)s:% (lineno)d)] - %(message)s"  # 字符串格式化输出
    formatter = logging.Formatter(fmt)  # 通过格式化器实例化一个对象
    # 设置处理器的格式
    sh.setFormatter(formatter)  # 将对象添加到处理器中
    fh.setFormatter(formatter)
    # 将处理器添加到日志中
    logger.addHandler(sh)  # 将处理器添加到日志器中
    logger.addHandler(fh)

```

##### 调用日志函数

![image-20240322113130276](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322113130276.png)

日志写入Ego.log文件

![image-20240322113101986](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322113101986.png)

##### 接口测试的实现

![image-20240322194101703](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240322194101703.png)

###### 获取轮播图接口封装

```python
# 1.导包
import requests

# 2.封装测试类
import app


class IndexApi(object):
    # 定义初始化方法(作用:定义实例化之后的对象和属性)
    def __init__(self):
        self.banner_url = app.URL + "/api/v1/banner/{}"  # 设置全局变量

    # 定义接口方法
    # 获取轮播图
    def get_banner(self,banner_id):
        new_url = self.banner_url.format(banner_id)#格式化输出，替换占位符
        return requests.get(new_url)

```

###### 获取专题栏为接口封装

```python
def __init__(self):
    self.banner_url = app.URL + "/api/v1/banner/{}"  # 设置全局变量
    self.theme_url = app.URL + "api/v1/theme"
```

```python
def get_theme(self, ids):
    # ?ids=1,2,3 转化为JSON数据,然后和url拼接，再通过get方法发送
    # {“ids”:1,2,3}
    data = {"ids": ids}
    return requests.get(self.theme_url, params=data)#添 加查询参数获取
```

###### 获取最新商品接口封装

```python
def __init__(self):
    self.banner_url = app.URL + "/api/v1/banner/{}"  # 设置全局变量
    self.theme_url = app.URL + "api/v1/theme"
    self.recent_product_url=app.URL+"/api/v1/product/recent"
```

```python
def get_recent_prodict(self):
    return requests.get(self.recent_product_url)
```

###### 测试获取轮播图接口

script包下创建调用接口测试方法

![image-20240323121006823](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240323121006823.png)

```python
# 导包
import logging
import unittest

# 2.定义测试类
import requests

from api.index import IndexApi


class TestIndex(unittest.TestCase):
    # 初始化方法：已封装类实例化类对象
    @classmethod
    def setUpClass(cls) -> None:
        cls.index_api = IndexApi()  # 拿到类对象，直接调用类方法

    # 调用已封装的测试接口
    # 调用获取轮播图接口的方法
    def test01_get_banner(self):
        # 测试数据
        banner_id = 1
        # 发送请求
        response = self.index_api.get_banner(banner_id)
        json_data = response.json()  # 将结果转为json数据
        logging.info(f"获取轮播图的结果为:{json_data}")  # 结果通过日志信息打印
        # 结果断言
        self.assertEqual(200, response.status_code)  # 断言响应状态码
        self.assertEqual(1,json_data.get("id"))
```

查看日志

![image-20240323121347816](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240323121347816.png)

###### 轮播图接口优化

配置全局变量

![image-20240323180326563](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240323180326563.png)

```python
def test01_get_banner(self):
    # 测试数据
    banner_id = app.bid
    # 发送请求
    response = self.index_api.get_banner(banner_id)
    json_data = response.json()  # 将结果转为json数据
    logging.info(f"获取轮播图的结果为:{json_data}")  # 结果通过日志信息打印
    # 结果断言
    self.assertEqual(200, response.status_code)  # 断言响应状态码
    self.assertEqual(banner_id, json_data.get("id"))
```

###### 测试获取专题栏位

```python
def test02_get_theme(self):
    # 测试数据
    ids = app.ids
    # 发送请求
    response = self.index_api.get_theme(ids)
    json_data = response.json()
    logging.info(f"获取专题栏的结果为:{json_data}")
    # 结果断言
    # 响应状态码
    self.assertEqual(200, response.status_code)
    # 断言列表的长度
    self.assertIsNone(len(json_data))
    # 将列表元素取出之后再断言
    # self.assertEqual(1,json_data[0].get("id"))
```

###### 测试获取最新商品

```python
def test03_get_recent_product(self):
    # 测试数据
    response = self.index_api.get_recent_prodict()
    # 发送请求
    json_data = response.json()
    logging.info(f"获取商品的结果为:{json_data}")
    # 结果断言
    self.assertEqual(200,response.status_code)
    self.assertIsNotNone(len(json_data))
```

###### 获取token接口的封装

创建新的py文件

![image-20240323212047479](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240323212047479.png)

###### 验证token接口的封装

```python
self.verify_url = app.URL + "/api/v1/token/verify"
```

```python
# 验证token接口封装
def verrify_token(self, token):
    data = {"token": token}
    return requests.post(self.verify_url, headers=app.headers, json=data)
```

###### 获取地址接口的封装

```python
self.address_url = app.URL + "/api/v1/address"
```

```python
def get_address(self):
    return requests.get(self.address_url,headers=app.header)
```

###### 获取token接口的测试

script包下新建文件

![image-20240323222837392](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240323222837392.png)

```python
    # 定义调用接口方法
    # 调用获取token的方法
    def test01_get_token(self):
        # 准备测试数据
        code = app.CODE
        # 发送请求
        response = self.user_api.get_token(code)
        json_data = response.json()
        logging.info(f"获取token的结果为:{json_data}")
        # 结果断言
        self.assertEqual(200, response.status_code)
        self.assertEqual(32, len(json_data.get("token")))  # 断言token值的长度是否为32
        # 断言包含关键词token
        self.assertIn("token", json_data)
```

将获取的token值保存到app.py文件中

```py
app.header["token"] = json_data.get("token")  # 修改字典值
logging.info(f"保存的token值：{app.header['token']}")
```

<img src="https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240324100604921.png" alt="image-20240324100604921" style="zoom:33%;" />

###### 验证token接口的测试

```py
def test01_verify_token(self):
    # 发送请求
    response = self.user_api.verify_token(app.header.get("token"))
    json_data = response.json()
    logging.info(f"验证token的结果为:{json_data}")
    # 结果断言
    self.assertEqual(200, response.status_code)

    #断言token值是否为真
    #第一种
    self.assertEqual(True, json_data.get("isValid"))
    #第二种
    self.assertTrue(json_data.get("isValid"))
```

验证地址信息

```python
def test03_get_address(self):
    # 测试数据

    # 发送请求
    response = self.user_api.get_address()
    json_data = response.json()
    logging.info(f"获取地址的结果为:{json_data}")
    # 结果断言
    self.assertEqual(200, response.status_code)
    #断言电话号
    self.assertEqual(app.phone,json_data.get("mobile"))
    self.assertEqual(app.name,json_data.get("name"))
```

###### 测试套件批量执行测试用例

在run_suite.py文件下进行批量测试

```python
# 1.导包
import unittest
from script.test_index import TestIndex
from script.test_user import TestUser

# 2.创建测试套件对象
suite = unittest.TestSuite()
# 3.添加测试用例到套件
suite.addTest(unittest.makeSuite(TestIndex))  # 添加测试类的名字
suite.addTest(unittest.makeSuite(TestUser))
# 4.批量执行测试用例
runner = unittest.TextTestRunner()  # 实例化执行器
runner.run(suite)
```

###### 生成测试报告

```python
# 1.导包
import unittest

import app
from script.test_index import TestIndex
from script.test_user import TestUser
from unittestreport import TestRunner

# 2.创建测试套件对象
suite = unittest.TestSuite()
# 3.添加测试用例到套件
suite.addTest(unittest.makeSuite(TestIndex))  # 添加测试类的名字
suite.addTest(unittest.makeSuite(TestUser))
# 4.批量执行测试用例
# runner = unittest.TextTestRunner()  # 实例化执行器
# runner.run(suite)

# 5.生成测试报告
# 5.1定义测试报告文件
rep_file = app.BASE_DIR + "/report/Ego.html"
# 5.2创建第三方执行器对象
# 参数：
# filename="report.html",
# report_dir="./reports",
# title='测试报告',
# tester='测试员',
# desc="XX项目测试生成的报告",
# templates=1
runner = TestRunner(suite,
                    filename=rep_file,
                    title="Ego微商项目的接口测试报告",
                    tester="Liang",
                    desc="V1.0",
                    templates=1)
# 5.3执行器调用run方法生成测试报告
runner.run()
```

生成的测试文件

![image-20240324111935108](https://mrssliang.oss-cn-beijing.aliyuncs.com/img/image-20240324111935108.png)